<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>The Love Sync</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            background: linear-gradient(135deg, #f8b6c1 0%, #f6d6e1 100%);
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        .container {
            background: #fff;
            border-radius: 32px;
            margin: 24px auto;
            max-width: 900px;
            padding: 32px 24px 48px 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            text-align: center;
        }
        h1 {
            color: #d32f5c;
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }
        .love {
            font-size: 2rem;
            color: #d32f5c;
            vertical-align: middle;
        }
        input[type="text"] {
            padding: 16px;
            margin: 12px 16px;
            border-radius: 12px;
            border: 2px solid #d32f5c;
            font-size: 1.2rem;
            width: 260px;
            text-align: center;
        }
        button {
            background: #d32f5c;
            color: #fff;
            border: none;
            border-radius: 16px;
            padding: 16px 40px;
            font-size: 1.3rem;
            margin-top: 18px;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:hover {
            background: #b71c48;
        }
        .question {
            margin: 24px 0 18px 0;
            font-size: 1.3rem;
        }
        .scale-group {
            margin: 18px 0 32px 0;
        }
        .scale-label {
            margin: 0 8px;
            font-size: 1.1rem;
        }
        .love-score {
            display: flex;
            justify-content: center;
            gap: 60px;
            margin-top: 40px;
        }
        .love-shape {
            width: 120px;
            height: 110px;
            background: #d32f5c;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 60% 60% 70% 70%;
            margin: 0 auto 12px auto;
        }
        .love-shape:before,
        .love-shape:after {
            content: "";
            position: absolute;
            width: 120px;
            height: 110px;
            background: #d32f5c;
            border-radius: 60% 60% 70% 70%;
        }
        .love-shape:before {
            left: -60px;
            top: 0;
        }
        .love-shape:after {
            left: 0;
            top: -60px;
        }
        .score-number {
            position: absolute;
            color: #fff;
            font-size: 2.2rem;
            font-weight: bold;
            left: 0; right: 0; top: 38px;
            text-align: center;
            z-index: 2;
            text-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .score-label {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 500;
            color: #d32f5c;
            margin-top: 0;
        }
        .score-message {
            margin-top: 24px;
            font-size: 1.2rem;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <div>
            <span class="love">ðŸ’•</span>
            <span style="font-size:2.5rem;font-weight:bold;color:#d32f5c;">The Love Sync</span>
            <span class="love">ðŸ’•</span>
        </div>
        <div style="margin: 0 0 18px 0; color: #555; font-size: 1.2rem;">
            Kalkulator Cinta untuk Pasangan - Mainkan dengan jarak 1-2 meter untuk jawaban jujur!
        </div>
        <div id="page1">
            <h2 style="margin-bottom: 10px;">Masukkan Nama Pasangan</h2>
            <input type="text" id="inputNameA" placeholder="Nama Person A">
            <input type="text" id="inputNameB" placeholder="Nama Person B">
            <br>
            <button onclick="startRoom()">Mulai</button>
            <div id="roomStatus" style="margin-top: 15px; font-weight: bold; color: red;"></div>
        </div>
        <div id="page2" style="display:none;"></div>
        <div id="page3" style="display:none;"></div>
    </div>
    <!-- Firebase SDK (ganti config sesuai project kamu) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
    // Ganti config berikut sesuai project Firebase kamu
    var firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
        databaseURL: "YOUR_DATABASE_URL",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT_ID.appspot.com",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    var db = firebase.database();

    // --- LOGIC ---
    let roomCode = null;
    let playerType = null; // 'A' atau 'B'
    let playerName = '';
    let partnerName = '';
    let questions = [
        "Seberapa sering kamu merasa didukung oleh pasanganmu?",
        "Seberapa puas kamu dengan komunikasi kalian?",
        "Seberapa besar kepercayaanmu pada pasanganmu?",
        "Seberapa sering kamu merasa dihargai oleh pasanganmu?",
        "Seberapa sering kamu dan pasanganmu menyelesaikan masalah bersama?",
        "Seberapa bahagia kamu dalam hubungan ini?",
        "Seberapa yakin kamu dengan masa depan hubungan ini?"
    ];
    let answers = [];
    let currentQuestion = 0;

    function startRoom() {
        const nameA = document.getElementById('inputNameA').value.trim();
        const nameB = document.getElementById('inputNameB').value.trim();
        if (!nameA || !nameB) {
            document.getElementById('roomStatus').innerText = 'Nama Person A dan B harus diisi!';
            return;
        }
        // Urutkan nama agar pasangan tidak tertukar
        const [n1, n2] = [nameA.toLowerCase(), nameB.toLowerCase()].sort();
        roomCode = `LOVE2-${n1}-${n2}`;
        playerType = (nameA.toLowerCase() === n1) ? 'A' : 'B';
        playerName = (playerType === 'A') ? nameA : nameB;
        partnerName = (playerType === 'A') ? nameB : nameA;

        // Simpan nama ke database
        db.ref('rooms/' + roomCode + '/player' + playerType).set({
            name: playerName,
            answers: null,
            submitted: false
        }).then(() => {
            document.getElementById('page1').style.display = 'none';
            document.getElementById('page2').style.display = '';
            showQuestion();
            listenToRoom();
        });
    }

    function showQuestion() {
        let html = `<h2>Pertanyaan untuk ${playerName}</h2>`;
        if (currentQuestion < questions.length) {
            html += `
                <div class="question">${questions[currentQuestion]}</div>
                <div class="scale-group">
                    <label class="scale-label"><input type="radio" name="scale" value="1"> 1</label>
                    <label class="scale-label"><input type="radio" name="scale" value="2"> 2</label>
                    <label class="scale-label"><input type="radio" name="scale" value="3"> 3</label>
                    <label class="scale-label"><input type="radio" name="scale" value="4"> 4</label>
                    <label class="scale-label"><input type="radio" name="scale" value="5"> 5</label>
                </div>
                <button onclick="submitAnswer()">Jawab</button>
            `;
        } else {
            html += `
                <div style="font-size:1.2rem;margin:24px 0 18px 0;">Semua pertanyaan sudah dijawab!</div>
                <button onclick="submitAllAnswers()">Selesai Jawab</button>
            `;
        }
        document.getElementById('page2').innerHTML = html;
    }

    function submitAnswer() {
        const radios = document.getElementsByName('scale');
        let val = null;
        for (let r of radios) if (r.checked) val = parseInt(r.value);
        if (!val) return;
        answers.push(val);
        currentQuestion++;
        showQuestion();
    }

    function submitAllAnswers() {
        db.ref(`rooms/${roomCode}/player${playerType}`).update({
            answers: answers,
            submitted: true
        });
        document.getElementById('page2').innerHTML = `<div style="font-size:1.2rem;margin:32px 0;">Jawaban Anda sudah terkirim.<br>Menunggu pasangan selesai menjawab...</div>`;
    }

    function listenToRoom() {
        db.ref('rooms/' + roomCode).on('value', snapshot => {
            const data = snapshot.val();
            if (!data) return;
            if (data.playerA && data.playerB && data.playerA.submitted && data.playerB.submitted) {
                showResult(data.playerA.answers, data.playerB.answers, data.playerA.name, data.playerB.name);
            }
        });
    }

    // Fungsi pesan sesuai persentase (dari gambar kamu)
    function getMessage(percentage) {
        if (percentage < 10) return 'Buruk banget! Ini bukan cinta, ini mungkin cuma teman sekamar. ðŸ’€';
        if (percentage < 20) return 'Aduh, ini agak mengkhawatirkan. Perlu banyak introspeksi dan usaha. ðŸ˜¬';
        if (percentage < 30) return 'Kurang ideal. Mungkin ada kesalahpahaman besar atau perbedaan prinsip. ðŸ˜”';
        if (percentage < 40) return 'Masih di bawah rata-rata. Butuh komunikasi serius dan kompromi. ðŸ˜•';
        if (percentage < 50) return 'Setengah-setengah. Ada potensi, tapi banyak PR yang harus dikerjakan. ðŸ¤”';
        if (percentage < 60) return 'Lumayan! Ada dasar yang baik, bisa dikembangkan lebih jauh. ðŸ˜‰';
        if (percentage < 70) return 'Cukup baik! Hubungan yang sehat dan menjanjikan. ðŸ‘';
        if (percentage < 80) return 'Sangat baik! Kalian punya koneksi yang kuat dan saling menghargai. ðŸ¤—';
        if (percentage < 90) return 'Luar biasa! Kalian adalah pasangan idaman, penuh cinta dan kebahagiaan. âœ¨';
        return 'Sempurna! Kalian adalah belahan jiwa sejati, ditakdirkan untuk bersama! ðŸ’–';
    }

    function showResult(ansA, ansB, nameA, nameB) {
        document.getElementById('page2').style.display = 'none';
        document.getElementById('page3').style.display = '';
        // Skoring: selisih tiap jawaban, makin kecil makin cocok
        let total = questions.length * 4; // max selisih 4 per soal
        let diff = 0;
        for (let i = 0; i < questions.length; i++) {
            diff += Math.abs((ansA[i]||0) - (ansB[i]||0));
        }
        let percent = Math.round(100 - (diff / total) * 100);
        percent = Math.max(0, Math.min(100, percent));
        let msg = getMessage(percent);

        document.getElementById('page3').innerHTML = `
            <h2>Hasil Love Sync</h2>
            <div class="love-score">
                <div>
                    <div class="love-shape"><span class="score-number">${percent}%</span></div>
                    <div class="score-label">${nameA}</div>
                </div>
                <div>
                    <div class="love-shape"><span class="score-number">${percent}%</span></div>
                    <div class="score-label">${nameB}</div>
                </div>
            </div>
            <div class="score-message">${msg}</div>
            <div style="margin-top:32px;">
                <button onclick="location.reload()">Main Lagi</button>
            </div>
        `;
    }
    </script>
</body>
</html>
