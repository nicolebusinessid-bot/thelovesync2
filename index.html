<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>The Love Sync</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            background: linear-gradient(135deg, #f8b6c1 0%, #f6d6e1 100%);
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        .container {
            background: #fff;
            border-radius: 32px;
            margin: 24px auto;
            max-width: 900px;
            padding: 32px 24px 48px 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            text-align: center;
        }
        .love {
            font-size: 2rem;
            color: #d32f5c;
            vertical-align: middle;
        }
        input[type="text"] {
            padding: 16px;
            margin: 12px 16px;
            border-radius: 12px;
            border: 2px solid #d32f5c;
            font-size: 1.2rem;
            width: 260px;
            text-align: center;
        }
        button {
            background: #d32f5c;
            color: #fff;
            border: none;
            border-radius: 16px;
            padding: 16px 40px;
            font-size: 1.3rem;
            margin-top: 18px;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:hover {
            background: #b71c48;
        }
        .question {
            margin: 24px 0 18px 0;
            font-size: 1.3rem;
        }
        .scale-group {
            margin: 18px 0 32px 0;
        }
        .scale-label {
            margin: 0 8px;
            font-size: 1.1rem;
        }
        .love-score {
            display: flex;
            justify-content: center;
            gap: 60px;
            margin-top: 40px;
        }
        .love-shape {
            width: 60px;
            height: 55px;
            background: transparent;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px auto;
        }
        .love-shape:before,
        .love-shape:after {
            content: "";
            position: absolute;
            width: 30px;
            height: 50px;
            background: #d32f5c;
            border-radius: 30px 30px 0 0;
            top: 0;
        }
        .love-shape:before {
            left: 15px;
            transform: rotate(-45deg);
        }
        .love-shape:after {
            left: 0;
            transform: rotate(45deg);
        }
        .score-number {
            position: absolute;
            color: #fff;
            font-size: 1.1rem;
            font-weight: bold;
            left: 0; right: 0; top: 18px;
            text-align: center;
            z-index: 2;
            text-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .score-label {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 500;
            color: #d32f5c;
            margin-top: 0;
        }
        .score-message {
            margin-top: 24px;
            font-size: 1.2rem;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <div>
            <span class="love">💕</span>
            <span style="font-size:2.5rem;font-weight:bold;color:#d32f5c;">The Love Sync</span>
            <span class="love">💕</span>
        </div>
        <div style="margin: 0 0 18px 0; color: #555; font-size: 1.2rem;">
            Isi namamu dan nama pasanganmu dengan menggunakan huruf kapital di awal!  LIKERT 7 POINT "1 = Sangat Tidak Setuju hingga 7 = Sangat Setuju"
        </div>
        <div id="page1">
            <h2 style="margin-bottom: 10px;">
                <span id="titleNames"><b>Person A</b> <span style="color:#d32f5c;">love</span> <b>Person B</b></span>
            </h2>
            <input type="text" id="inputNameA" placeholder="Namamu">
            <input type="text" id="inputNameB" placeholder="Nama pasanganmu">
            <br>
            <button onclick="startRoom()">Mulai</button>
            <div id="roomStatus" style="margin-top: 15px; font-weight: bold; color: red;"></div>
        </div>
        <div id="page2" style="display:none;"></div>
        <div id="page3" style="display:none;"></div>
    </div>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
    // Konfigurasi Firebase kamu
    const firebaseConfig = {
      apiKey: "AIzaSyAW5DicAgbM4c2pZ1Ppbe20MTIuk6sXv1M",
      authDomain: "the-love-sync-6ad07.firebaseapp.com",
      databaseURL: "https://the-love-sync-6ad07-default-rtdb.firebaseio.com",
      projectId: "the-love-sync-6ad07",
      storageBucket: "the-love-sync-6ad07.appspot.com",
      messagingSenderId: "112993733925",
      appId: "1:112993733925:web:0aa93f8c4e54d525325ecc",
      measurementId: "G-PBQDX39P1R"
    };
    firebase.initializeApp(firebaseConfig);
    var db = firebase.database();

    // --- LOGIC ---
    let roomCode = null;
    let playerType = null; // 'A' atau 'B'
    let playerName = '';
    let partnerName = '';
    let questions = [
        "Pasangan saya dan saya saling berbagi informasi pribadi satu sama lain",
        "Tidak ada hal yang tidak bisa saya ceritakan kepada pasangan saya",
        "Pasangan saya dan saya saling berbagi pikiran dan informasi pribadi satu sama lain",
        "Ada hal-hal yang bisa saya ceritakan kepada pasangan saya yang tidak bisa saya ceritakan kepada orang lain",
        "Pasangan saya memahami perasaan saya",
        "Pasangan saya dan saya dekat secara psikologis satu sama lain",
        "Saya merasa dekat dengan pasangan saya hampir sepanjang waktu"
    ];
    let answers = [];
    let currentQuestion = 0;
    let inputA = document.getElementById('inputNameA');
    let inputB = document.getElementById('inputNameB');
    inputA.addEventListener('input', updateTitleNames);
    inputB.addEventListener('input', updateTitleNames);

    function updateTitleNames() {
        let a = inputA.value.trim() || "Person A";
        let b = inputB.value.trim() || "Person B";
        document.getElementById('titleNames').innerHTML = `<b>${a}</b> <span style="color:#d32f5c;">love</span> <b>${b}</b>`;
    }

    function startRoom() {
        const nameA = inputA.value.trim();
        const nameB = inputB.value.trim();
        if (!nameA || !nameB) {
            document.getElementById('roomStatus').innerText = 'Isi namamu dan nama pasanganmu!';
            return;
        }
        document.getElementById('roomStatus').innerText = '';
        // Room code tetap urut alfabet agar dua device masuk room sama
        const [n1, n2] = [nameA.toLowerCase(), nameB.toLowerCase()].sort();
        roomCode = `LOVE2-${n1}-${n2}`;

        // Deteksi: jika sudah ada playerA, device kedua otomatis jadi playerB
        db.ref('rooms/' + roomCode).once('value').then(snapshot => {
            let data = snapshot.val();
            if (!data) {
                // Room baru, device ini jadi A
                playerType = 'A';
                playerName = nameA;
                partnerName = nameB;
            } else if (data.playerA && data.playerA.name === nameA) {
                playerType = 'A';
                playerName = nameA;
                partnerName = nameB;
            } else if (data.playerB && data.playerB.name === nameA) {
                playerType = 'B';
                playerName = nameA;
                partnerName = nameB;
            } else if (!data.playerA || !data.playerA.name) {
                playerType = 'A';
                playerName = nameA;
                partnerName = nameB;
            } else if (!data.playerB || !data.playerB.name) {
                playerType = 'B';
                playerName = nameA;
                partnerName = nameB;
            } else {
                document.getElementById('roomStatus').innerText = 'Room sudah penuh!';
                return;
            }
            db.ref('rooms/' + roomCode + '/player' + playerType).set({
                name: playerName,
                answers: null,
                submitted: false
            }).then(() => {
                document.getElementById('page1').style.display = 'none';
                document.getElementById('page2').style.display = '';
                showQuestion();
                listenToRoom();
            });
        });
    }

    function showQuestion() {
        let html = `<h2>Pertanyaan untuk ${playerName}</h2>`;
        if (currentQuestion < questions.length) {
            html += `
                <div class="question">${questions[currentQuestion]}</div>
                <div class="scale-group">
                    <label class="scale-label"><input type="radio" name="scale" value="1"> 1</label>
                    <label class="scale-label"><input type="radio" name="scale" value="2"> 2</label>
                    <label class="scale-label"><input type="radio" name="scale" value="3"> 3</label>
                    <label class="scale-label"><input type="radio" name="scale" value="4"> 4</label>
                    <label class="scale-label"><input type="radio" name="scale" value="5"> 5</label>
                    <label class="scale-label"><input type="radio" name="scale" value="6"> 6</label>
                    <label class="scale-label"><input type="radio" name="scale" value="7"> 7</label>
                </div>
                <button onclick="submitAnswer()">Jawab</button>
            `;
        } else {
            html += `
                <div style="font-size:1.2rem;margin:24px 0 18px 0;">Semua pertanyaan sudah dijawab!</div>
                <button onclick="submitAllAnswers()">Selesai Jawab</button>
            `;
        }
        document.getElementById('page2').innerHTML = html;
    }

    function submitAnswer() {
        const radios = document.getElementsByName('scale');
        let val = null;
        for (let r of radios) if (r.checked) val = parseInt(r.value);
        if (!val) return;
        answers.push(val);
        currentQuestion++;
        showQuestion();
    }

    function submitAllAnswers() {
        db.ref(`rooms/${roomCode}/player${playerType}`).update({
            answers: answers,
            submitted: true
        });
        document.getElementById('page2').innerHTML = `<div style="font-size:1.2rem;margin:32px 0;">Jawaban Anda sudah terkirim.<br>Menunggu pasangan selesai menjawab...</div>`;
    }

    function listenToRoom() {
        db.ref('rooms/' + roomCode).on('value', snapshot => {
            const data = snapshot.val();
            if (!data) return;
            if (data.playerA && data.playerB && data.playerA.submitted && data.playerB.submitted) {
                // Selalu urutkan sesuai input halaman pertama
                let nameA = document.getElementById('inputNameA').value.trim();
                let nameB = document.getElementById('inputNameB').value.trim();
                let ansA = (data.playerA && data.playerA.name === nameA) ? data.playerA.answers : data.playerB.answers;
                let ansB = (data.playerB && data.playerB.name === nameB) ? data.playerB.answers : data.playerA.answers;
                showResult(ansA, ansB, nameA, nameB);
            }
        });
    }

    function getMessage(percentage) {
        if (percentage < 10) return 'Waduh, sangat penting untuk anda mengintrospeksi diri mendalam dan bekerja keras untuk mencari inti persoalan 💀';
        if (percentage < 20) return 'Anda perlu kejujuran  dan komunikasi yang jelas untuk melihat apakah hubungan masih ada harapan untuk diperbaiki 😬';
        if (percentage < 30) return 'Mencari titik kejujuran anda adalah kunci untuk melanjutkan hubungan 😔';
        if (percentage < 40) return 'Ada pekerjaan rumah yang harus anda segera selesaikan agar hubungan bisa mencapai level berikutnya 😕';
        if (percentage < 50) return 'Ini saat yang tepat untuk anda memperkuat ikatan dan membangun fondasi hubungan yang lebih kuat 🤔';
        if (percentage < 60) return 'Usaha konsisten anda akan membuat hubungan jauh lebih kuat 😉';
        if (percentage < 70) return 'Lucunya, kasih sayang yang dijaga akan membuat pasangan anda semakin terbuka dalam bercerita👍';
        if (percentage < 80) return 'Anda sudah stabil dan penuh potensi untuk berkembang lebih jauh 🤗';
        if (percentage < 90) return 'Kekuatan hubungan anda ini bisa jadi inspirasi bagi orang lain ✨';
        return 'Hubungan ini mencerminkan keharmonisan yang indah dan tahan lama 💖';
    }

    function showResult(ansA, ansB, nameA, nameB) {
    document.getElementById('page2').style.display = 'none';
    document.getElementById('page3').style.display = '';

    let maxScore = ansA.length * 7;
    let totalA = ansA.reduce((a, b) => a + b, 0);
    let percentA = Math.round((totalA / maxScore) * 100);

    let totalB = ansB.reduce((a, b) => a + b, 0);
    let percentB = Math.round((totalB / maxScore) * 100);

    let msgA = getMessage(percentA);
    let msgB = getMessage(percentB);

    document.getElementById('page3').innerHTML = `
        <h2>Hasil Love Sync</h2>
        <div class="love-score">
            <div>
                <div class="love-shape"><span class="score-number">${percentA}%</span></div>
                <div class="score-label">${nameA}</div>
            </div>
            <div>
                <div class="love-shape"><span class="score-number">${percentB}%</span></div>
                <div class="score-label">${nameB}</div>
            </div>
        </div>
        <div class="score-message">
            <b>${nameA}:</b> ${msgA}<br><br>
            <b>${nameB}:</b> ${msgB}
        </div>
        <div style="margin-top:32px;">
            <button onclick="location.reload()">Main Lagi</button>
        </div>
    `;

    // Kirim data ke Google Sheets via Google Apps Script
    fetch('https://script.google.com/macros/s/AKfycbwTvIC1pRn5IEBYDUvhwWcP8WZQCVzZuuCI67u0_HRNqQJWrcGrFkThAN5X__6wWyin2w/exec', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        namaA: nameA,
        namaB: nameB,
        jawabanA: ansA.join(','),
        jawabanB: ansB.join(','),
        persenA: percentA,
        persenB: percentB
      })
    });
}
    
    // Agar tombol Mulai bisa dipanggil dari HTML
    window.startRoom = startRoom;
    </script>
</body>
</html>
